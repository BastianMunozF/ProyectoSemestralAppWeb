"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4535],{4535:(j,w,d)=>{d.d(w,{N:()=>f});var _=d(5861),s=d(5619),h=d(5879),b=d(5320),m=d(9843),R=d(2058);let f=(()=>{var c;class v{constructor(r,e,a,t){this.sqlite=r,this.platform=e,this.alertController=a,this.router=t,this.tablaTipo="CREATE TABLE IF NOT EXISTS tipo (id_tipo INTEGER PRIMARY KEY AUTOINCREMENT, descripcion VARCHAR(20));",this.tablaRol="CREATE TABLE IF NOT EXISTS rol (id_rol INTEGER PRIMARY KEY AUTOINCREMENT, nombrerol VARCHAR(10));",this.tablaUsuarios="CREATE TABLE IF NOT EXISTS usuario (id INTEGER PRIMARY KEY AUTOINCREMENT, nombre VARCHAR(30) NOT NULL, apellido VARCHAR(30) NOT NULL, correo VARCHAR(30) NOT NULL, fechanacimiento DATE NOT NULL, rut VARCHAR(13) NOT NULL, celular INTEGER NOT NULL, contrasena VARCHAR(30) NOT NULL, fotoperfil VARCHAR(100) NOT NULL, id_rol INTEGER NOT NULL, FOREIGN KEY(id_rol) REFERENCES rol(id_rol));",this.tablaVehiculo="CREATE TABLE IF NOT EXISTS vehiculo (id_vehiculo INTEGER PRIMARY KEY AUTOINCREMENT, marca VARCHAR(30) NOT NULL, modelo VARCHAR(30) NOT NULL, anio INTEGER NOT NULL, patente VARCHAR(6) NOT NULL, asientos INTEGER NOT NULL, id_usuario INTEGER NOT NULL, id_tipo INTEGER NOT NULL, FOREIGN KEY(id_usuario) REFERENCES usuario(id), FOREIGN KEY(id_tipo) REFERENCES tipo(id_tipo));",this.tablaViajes="CREATE TABLE IF NOT EXISTS viaje (id_viaje INTEGER PRIMARY KEY AUTOINCREMENT, f_viaje DATE NOT NULL, hora_salida DATETIME NOT NULL, salida VARCHAR(30) NOT NULL, destino VARCHAR(30) NOT NULL, cant_asientos INTEGER NOT NULL, valor_asiento INTEGER NOT NULL, estado VARCHAR(20) NOT NULL, id_conductor INTEGER NOT NULL, FOREIGN KEY(id_conductor) REFERENCES usuario(id));",this.tablaViajesUser="CREATE TABLE IF NOT EXISTS viajeuser(id_viajeuser INTEGER PRIMARY KEY AUTOINCREMENT, f_viaje DATE NOT NULL, hora_salida DATETIME NOT NULL, salida VARCHAR(30) NOT NULL, destino VARCHAR(30) NOT NULL)",this.tablaDetalle="CREATE TABLE IF NOT EXISTS detalle (id_detalle INTEGER PRIMARY KEY AUTOINCREMENT, id_usuario INTEGER NOT NULL, id_viaje INTEGER NOT NULL, FOREIGN KEY(id_usuario) REFERENCES usuario(id), FOREIGN KEY(id_viaje) REFERENCES viaje(id_viaje));",this.registroRol="INSERT INTO rol VALUES (1, 'Usuario'), (2, 'Conductor');",this.registroTipoVehiculo="INSERT INTO tipo VALUES (1, 'Standard'), (2, 'Large'), (3, 'Deluxe')",this.listaUsuario=new s.X([]),this.listaUsuarioViaje=new s.X([]),this.listaConductor=new s.X([]),this.listaViaje=new s.X([]),this.listaViajeId=new s.X([]),this.listaViajeUser=new s.X([]),this.listaViajeIniciado=new s.X([]),this.listaViajeCreadoUser=new s.X([]),this.listaVehiculo=new s.X([]),this.listaVehiculoUser=new s.X([]),this.listaViajeReservado=new s.X([]),this.listaUsuarioId=new s.X([]),this.listaDetalle=new s.X([]),this.listaDetalleId=new s.X([]),this.listaDetalleUser=new s.X([]),this.listaDetalleViaje=new s.X([]),this.listaDetalleViajeUserId=new s.X([]),this.isDBReady=new s.X(!1),this.crearBD()}dbState(){return this.isDBReady.asObservable()}fetchUsuario(){return this.listaUsuario.asObservable()}fetchConductor(){return this.listaConductor.asObservable()}fetchUsuarioViaje(){return this.listaUsuarioViaje.asObservable()}fetchVehiculo(){return this.listaVehiculo.asObservable()}fetchViaje(){return this.listaViaje.asObservable()}fetchViajeId(){return this.listaViajeId.asObservable()}fetchViajeUser(){return this.listaViajeUser.asObservable()}fetchViajeAceptado(){return this.listaViajeIniciado.asObservable()}fetchViajeCreadoUser(){return this.listaViajeCreadoUser.asObservable()}fetchViajeReservado(){return this.listaViajeReservado.asObservable()}fetchUsuarioId(){return this.listaUsuarioId.asObservable()}fetchVehiculoUser(){return this.listaVehiculoUser.asObservable()}fetchDetalle(){return this.listaDetalle.asObservable()}fetchDetalleId(){return this.listaDetalleId.asObservable()}fetchDetalleUser(){return this.listaDetalleUser.asObservable()}fetchDetalleViaje(){return this.listaDetalleViaje.asObservable()}fetchDetalleViajeUserId(){return this.listaDetalleViajeUserId.asObservable()}buscarCorreo(r,e){return this.database.executeSql("SELECT id, id_rol FROM usuario WHERE correo = ? AND contrasena = ?",[r,e]).then(a=>a.rows.length>0?a.rows.item(0):null).catch(a=>(this.presentAlert("Error al buscar usuario:"+a),!1))}buscarDatosUsuario(r){return this.database?this.database.executeSql("SELECT * FROM usuario WHERE id = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id:e.rows.item(t).id,nombre:e.rows.item(t).nombre,apellido:e.rows.item(t).apellido,correo:e.rows.item(t).correo,fechanacimiento:e.rows.item(t).fechanacimiento,rut:e.rows.item(t).rut,celular:e.rows.item(t).celular,contrasena:e.rows.item(t).contrasena,fotoperfil:e.rows.item(t).fotoperfil});return this.listaUsuarioId.next(a),a}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarDatosConductor(r){return this.database?this.database.executeSql("SELECT * FROM usuario WHERE id = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id:e.rows.item(t).id,nombre:e.rows.item(t).nombre,apellido:e.rows.item(t).apellido,correo:e.rows.item(t).correo,fechanacimiento:e.rows.item(t).fechanacimiento,rut:e.rows.item(t).rut,celular:e.rows.item(t).celular,contrasena:e.rows.item(t).contrasena,fotoperfil:e.rows.item(t).fotoperfil});return this.listaConductor.next(a),a}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarUsuarioViaje(r){return this.database?this.database.executeSql("SELECT * FROM usuario WHERE id = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id:e.rows.item(t).id,nombre:e.rows.item(t).nombre,apellido:e.rows.item(t).apellido,correo:e.rows.item(t).correo,fechanacimiento:e.rows.item(t).fechanacimiento,rut:e.rows.item(t).rut,celular:e.rows.item(t).celular,contrasena:e.rows.item(t).contrasena,fotoperfil:e.rows.item(t).fotoperfil});return this.listaUsuarioViaje.next(a),a}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarVehiculoUsuario(r){return this.database?this.database.executeSql("SELECT * FROM vehiculo WHERE id_usuario = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_vehiculo:e.rows.item(t).id_vehiculo,marca:e.rows.item(t).marca,modelo:e.rows.item(t).modelo,anio:e.rows.item(t).anio,patente:e.rows.item(t).patente,asientos:e.rows.item(t).asientos,id_usuario:e.rows.item(t).id_usuario,id_tipo:e.rows.item(t).id_tipo});return this.listaVehiculoUser.next(a),a}):(console.error("Error: this.database no est\xe1 definido."),Promise.resolve([]))}buscarViajeUser(r){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE id_conductor = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_viaje:e.rows.item(t).id_viaje,f_viaje:e.rows.item(t).f_viaje,hora_salida:e.rows.item(t).hora_salida,salida:e.rows.item(t).salida,destino:e.rows.item(t).destino,cant_asientos:e.rows.item(t).cant_asientos,valor_asiento:e.rows.item(t).valor_asiento,estado:e.rows.item(t).estado,id_usuario:e.rows.item(t).id_usuario});return this.listaViajeUser.next(a),a}):(console.error("Error: this.database no est\xe1 definido o no se ha inicializado correctamente."),Promise.resolve([]))}buscarViajeCreadoUser(r,e){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE id_conductor = ? AND estado = ?",[r,e]).then(a=>{let t=[];if(a.rows.length>0)for(var i=0;i<a.rows.length;i++)t.push({id_viaje:a.rows.item(i).id_viaje,f_viaje:a.rows.item(i).f_viaje,hora_salida:a.rows.item(i).hora_salida,salida:a.rows.item(i).salida,destino:a.rows.item(i).destino,cant_asientos:a.rows.item(i).cant_asientos,valor_asiento:a.rows.item(i).valor_asiento,estado:a.rows.item(i).estado,id_usuario:a.rows.item(i).id_usuario});return this.listaViajeCreadoUser.next(t),t}):(console.error("Error: this.database no est\xe1 definido o no se ha inicializado correctamente."),Promise.resolve([]))}buscarDetalleUsuario(r,e){return this.database&&this.database?this.database.executeSql("SELECT * FROM detalle WHERE id_usuario = ? AND id_viaje = ?",[r,e]).then(a=>{let t=[];if(a.rows.length>0)for(var i=0;i<a.rows.length;i++)t.push({id_detalle:a.rows.item(i).id_detalle,id_usuario:a.rows.item(i).id_usuario,id_viaje:a.rows.item(i).id_viaje});return this.listaDetalleViajeUserId.next(t),t}):(console.error("Error: this.database no est\xe1 definido."),Promise.resolve([]))}buscarDetalleUser(r){return this.database?this.database.executeSql("SELECT * FROM detalle WHERE id_usuario = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_detalle:e.rows.item(t).id_detalle,id_usuario:e.rows.item(t).id_usuario,id_viaje:e.rows.item(t).id_viaje});return this.listaDetalleUser.next(a),a}):(console.error("Error: this.database no est\xe1 definido."),Promise.resolve([]))}buscarDetalleViaje(r){return this.database?this.database.executeSql("SELECT * FROM detalle WHERE id_viaje = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_detalle:e.rows.item(t).id_detalle,id_usuario:e.rows.item(t).id_usuario,id_viaje:e.rows.item(t).id_viaje});return this.listaDetalleViaje.next(a),a}):(console.error("Error: this.database no est\xe1 definido."),Promise.resolve([]))}buscarViajeUserAceptado(r,e){return this.database?this.database.executeSql("SELECT * FROM detalle WHERE id_usuario = ? AND id_viaje = ?",[r,e]).then(a=>{let t=[];if(a.rows.length>0)for(var i=0;i<a.rows.length;i++)t.push({id_detalle:a.rows.item(i).id_detalle,id_usuario:a.rows.item(i).id_usuario,id_viaje:a.rows.item(i).id_viaje});return this.listaDetalleViajeUserId.next(t),t}):(console.error("Error: this.database no est\xe1 definido."),Promise.resolve([]))}buscarViajeId(r){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE id_viaje = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_viaje:e.rows.item(t).id_viaje,f_viaje:e.rows.item(t).f_viaje,hora_salida:e.rows.item(t).hora_salida,salida:e.rows.item(t).salida,destino:e.rows.item(t).destino,cant_asientos:e.rows.item(t).cant_asientos,valor_asiento:e.rows.item(t).valor_asiento,estado:e.rows.item(t).estado,id_usuario:e.rows.item(t).id_usuario});return this.listaViajeId.next(a),a}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarViajeAceptado(r){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE estado = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_viaje:e.rows.item(t).id_viaje,f_viaje:e.rows.item(t).f_viaje,hora_salida:e.rows.item(t).hora_salida,salida:e.rows.item(t).salida,destino:e.rows.item(t).destino,cant_asientos:e.rows.item(t).cant_asientos,valor_asiento:e.rows.item(t).valor_asiento,estado:e.rows.item(t).estado,id_usuario:e.rows.item(t).id_usuario});return a}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarViajeReservado(r,e){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE id_viaje = ? AND estado = ?",[r,e]).then(a=>{let t=[];if(a.rows.length>0)for(var i=0;i<a.rows.length;i++)t.push({id_viaje:a.rows.item(i).id_viaje,f_viaje:a.rows.item(i).f_viaje,hora_salida:a.rows.item(i).hora_salida,salida:a.rows.item(i).salida,destino:a.rows.item(i).destino,cant_asientos:a.rows.item(i).cant_asientos,valor_asiento:a.rows.item(i).valor_asiento,estado:a.rows.item(i).estado,id_usuario:a.rows.item(i).id_conductor});return this.listaViajeReservado.next(t),t}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarViaje(r){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE estado = ?",[r]).then(e=>{let a=[];if(e.rows.length>0)for(var t=0;t<e.rows.length;t++)a.push({id_viaje:e.rows.item(t).id_viaje,f_viaje:e.rows.item(t).f_viaje,hora_salida:e.rows.item(t).hora_salida,salida:e.rows.item(t).salida,destino:e.rows.item(t).destino,cant_asientos:e.rows.item(t).cant_asientos,valor_asiento:e.rows.item(t).valor_asiento,estado:e.rows.item(t).estado,id_usuario:e.rows.item(t).id_usuario});return this.listaViaje.next(a),a}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarViajeIniciado(r,e){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE id_conductor = ? AND estado = ?",[r,e]).then(a=>{let t=[];if(a.rows.length>0)for(var i=0;i<a.rows.length;i++)t.push({id_viaje:a.rows.item(i).id_viaje,f_viaje:a.rows.item(i).f_viaje,hora_salida:a.rows.item(i).hora_salida,salida:a.rows.item(i).salida,destino:a.rows.item(i).destino,cant_asientos:a.rows.item(i).cant_asientos,valor_asiento:a.rows.item(i).valor_asiento,estado:a.rows.item(i).estado,id_usuario:a.rows.item(i).id_conductor});return this.listaViajeIniciado.next(t),t}):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}buscarDetalle(){return this.database.executeSql("SELECT * FROM detalle",[]).then(r=>{let e=[];if(r.rows.length>0)for(var a=0;a<r.rows.length;a++)e.push({id_detalle:r.rows.item(a).id_detalle,id_usuario:r.rows.item(a).id_usuario,id_viaje:r.rows.item(a).id_viaje});return this.listaDetalle.next(e),e})}buscarUsuario(){return this.database.executeSql("SELECT * FROM usuario",[]).then(r=>{let e=[];if(r.rows.length>0)for(var a=0;a<r.rows.length;a++)e.push({id:r.rows.item(a).id,nombre:r.rows.item(a).nombre,apellido:r.rows.item(a).apellido,fechanacimiento:r.rows.item(a).fechanacimiento,correo:r.rows.item(a).correo,rut:r.rows.item(a).rut,celular:r.rows.item(a).celular,contrasena:r.rows.item(a).contrasena,fotoperfil:r.rows.item(a).fotoperfil});this.listaUsuario.next(e)})}buscarVehiculo(){return this.database.executeSql("SELECT * FROM vehiculo",[]).then(r=>{let e=[];if(r.rows.length>0)for(var a=0;a<r.rows.length;a++)e.push({id_vehiculo:r.rows.item(a).id_vehiculo,marca:r.rows.item(a).marca,modelo:r.rows.item(a).modelo,anio:r.rows.item(a).anio,patente:r.rows.item(a).patente,asientos:r.rows.item(a).asientos,id_usuario:r.rows.item(a).id_usuario,id_tipo:r.rows.item(a).id_tipo});this.listaVehiculo.next(e)})}insertarUsuario(r,e,a,t,i,l,o,n,u){return this.database.executeSql("INSERT INTO usuario(nombre, apellido, correo, fechanacimiento, rut, celular, contrasena, fotoperfil, id_rol) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)",[r,e,a,t,i,l,o,n,u]).then(E=>!!E||(this.presentAlert("Error al insertar usuario en la base de datos."),null)).catch(E=>{console.error("Error al insertar el usuario.",E)})}insertarVehiculo(r,e,a,t,i,l,o){return this.database.executeSql("INSERT INTO vehiculo(marca, modelo, anio, patente, asientos, id_usuario, id_tipo) VALUES (?, ?, ?, ?, ?, ?, ?)",[r,e,a,t,i,l,o]).then(n=>{n?this.buscarVehiculo():this.presentAlert("Error al insertar veh\xedculo en la base de datos.")}).catch(n=>{console.error("Error al insertar el veh\xedculo.",n)})}insertarRutaC(r,e,a,t,i,l,o,n){return this.database.executeSql("INSERT INTO viaje(f_viaje, hora_salida, salida, destino, cant_asientos, valor_asiento, estado, id_conductor) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[r,e,a,t,i,l,o,n]).then(u=>{u?this.buscarViaje(o):this.presentAlert("Error al insertar ruta.")}).catch(u=>{console.error("Error al insertar el veh\xedculo:",u)})}insertarViajeAceptado(r,e){return this.database.executeSql("INSERT INTO detalle(id_usuario, id_viaje) VALUES (?, ?)",[r,e]).then(a=>a?(this.buscarDetalleUser(r),!0):(this.presentAlert("Error al insertar detalle"),null))}eliminarViajeUser(r){return this.database.executeSql("DELETE FROM viaje WHERE id_viaje = ?",[r]).then(e=>!!e||(console.log("Error al eliminar el viaje del usuario."),null)).catch(e=>{console.error("Error al eliminar viaje:",e)})}cancelarReservaUser(r,e){return this.database.executeSql("DELETE FROM detalle WHERE id_usuario = ? AND id_viaje = ?",[r,e]).then(a=>a?(this.buscarDetalleUser(r),!0):null)}verificarViaje(r){return this.database?this.database.executeSql("SELECT * FROM viaje WHERE id_conductor = ?",[r]).then(e=>!!e||(this.presentAlert("Error al verificar el viaje."),null)):(console.error("La base de datos no est\xe1 inicializada."),Promise.resolve([]))}actualizarPerfil(r,e,a,t,i,l,o,n){return this.database.executeSql("UPDATE usuario SET nombre = ?, apellido = ?, correo = ?, fechanacimiento = ?, rut = ?, celular = ?, fotoperfil = ? WHERE id = ?",[r,e,a,t,i,l,o,n]).then(u=>{if(u){let E=localStorage.getItem("id");return this.buscarDatosUsuario(E),!0}return this.presentAlert("Error al actualizar usuario."),null}).catch(u=>{console.error("Error al actualizar usuario en base de datos:",u)})}actualizarVehiculo(r,e,a,t,i,l){return this.database.executeSql("UPDATE vehiculo SET marca = ?, modelo = ?, anio = ?, patente = ?, asientos = ? WHERE id_usuario = ?",[r,e,a,t,i,l]).then(o=>!!o||null)}actualizarContrasena(r,e){return this.database.executeSql("UPDATE usuario SET contrasena = ? WHERE id = ?",[r,e]).then(a=>!!a||(this.presentAlert("Error al actualizar contrase\xf1a."),null))}actualizarEstadoViaje(r,e){return this.database.executeSql("UPDATE viaje SET cant_asientos = ? WHERE id_viaje = ?",[r,e]).then(a=>!!a||(this.presentAlert("Error al actualizar estado de viaje."),null))}actualizarViaje(r,e){return this.database.executeSql("UPDATE viaje SET estado = ? WHERE id_viaje = ?",[r,e]).then(a=>!!a||(this.presentAlert("Error al actualizar estado del viaje."),null))}verificarContrasena(r){return this.database.executeSql("SELECT contrasena FROM usuario WHERE id = ?",[r]).then(e=>!!e||null)}recuperarBuscar(r,e){return this.database.executeSql("SELECT * FROM usuario WHERE correo = ? AND rut = ?",[r,e]).then(a=>a.rows.length>0?a.rows.item(0):null)}recuperarUsuario(r,e,a){return this.database.executeSql("UPDATE usuario SET contrasena = ? WHERE correo = ? AND rut = ?",[r,e,a]).then(t=>t?(this.buscarUsuario(),!0):(this.presentAlert("Error al actualizar contrase\xf1a."),null)).catch(t=>{console.error("Error al modificar la contrase\xf1a de usuario en la base de datos:",t)})}crearBD(){this.platform.ready().then(()=>{this.sqlite.create({name:"bdviago.bd",location:"default"}).then(r=>{this.database=r,this.crearTablas()}).catch(r=>{this.presentAlert("Error en platform: "+r)})})}crearTablas(){var r=this;return(0,_.Z)(function*(){try{yield r.database.executeSql(r.tablaTipo,[]),yield r.database.executeSql(r.tablaRol,[]),yield r.database.executeSql(r.tablaUsuarios,[]),yield r.database.executeSql(r.tablaVehiculo,[]),yield r.database.executeSql(r.tablaViajes,[]),yield r.database.executeSql(r.tablaDetalle,[]),yield r.database.executeSql(r.registroRol,[]),yield r.database.executeSql(r.registroTipoVehiculo,[]),r.isDBReady.next(!0)}catch(e){console.error("Error en Crear Tablas: "+e)}})()}presentAlert(r){var e=this;return(0,_.Z)(function*(){yield(yield e.alertController.create({header:"Error",message:r,buttons:["Aceptar"]})).present()})()}}return(c=v).\u0275fac=function(r){return new(r||c)(h.LFG(b.e),h.LFG(m.t4),h.LFG(m.Br),h.LFG(R.F0))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),v})()}}]);