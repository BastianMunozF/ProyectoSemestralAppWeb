"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7048],{5961:(B,y,b)=>{b.d(y,{GW:()=>_,dk:()=>R,oK:()=>c});var c=function(E){return E.Prompt="PROMPT",E.Camera="CAMERA",E.Photos="PHOTOS",E}(c||{}),_=function(E){return E.Rear="REAR",E.Front="FRONT",E}(_||{}),R=function(E){return E.Uri="uri",E.Base64="base64",E.DataUrl="dataUrl",E}(R||{})},8162:(B,y,b)=>{b.d(y,{V1:()=>R,dk:()=>_.dk,oK:()=>_.oK});var c=b(2726),_=b(5961);const R=(0,c.fo)("Camera",{web:()=>b.e(6468).then(b.bind(b,6468)).then(E=>new E.CameraWeb)})},2726:(B,y,b)=>{b.d(y,{Uw:()=>N,fo:()=>h,xz:()=>U});var c=b(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var T=function(r){return r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE",r}(T||{});class U extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const n=r=>{var e,t,a,s,o;const d=r.CapacitorCustomPlatform||null,i=r.Capacitor||{},g=i.Plugins=i.Plugins||{},f=r.CapacitorPlatforms,D=(null===(e=null==f?void 0:f.currentPlatform)||void 0===e?void 0:e.getPlatform)||(()=>null!==d?d.name:(r=>{var e,t;return null!=r&&r.androidBridge?"android":null!==(t=null===(e=null==r?void 0:r.webkit)||void 0===e?void 0:e.messageHandlers)&&void 0!==t&&t.bridge?"ios":"web"})(r)),le=(null===(t=null==f?void 0:f.currentPlatform)||void 0===t?void 0:t.isNativePlatform)||(()=>"web"!==D()),ue=(null===(a=null==f?void 0:f.currentPlatform)||void 0===a?void 0:a.isPluginAvailable)||(m=>{const v=Z.get(m);return!!(null!=v&&v.platforms.has(D())||Q(m))}),Q=(null===(s=null==f?void 0:f.currentPlatform)||void 0===s?void 0:s.getPluginHeader)||(m=>{var v;return null===(v=i.PluginHeaders)||void 0===v?void 0:v.find(x=>x.name===m)}),Z=new Map,me=(null===(o=null==f?void 0:f.currentPlatform)||void 0===o?void 0:o.registerPlugin)||((m,v={})=>{const x=Z.get(m);if(x)return console.warn(`Capacitor plugin "${m}" already registered. Cannot register plugins twice.`),x.proxy;const I=D(),G=Q(m);let O;const be=function(){var p=(0,c.Z)(function*(){return!O&&I in v?O=O="function"==typeof v[I]?yield v[I]():v[I]:null!==d&&!O&&"web"in v&&(O=O="function"==typeof v.web?yield v.web():v.web),O});return function(){return p.apply(this,arguments)}}(),Y=p=>{let P;const w=(...C)=>{const A=be().then(L=>{const S=((p,P)=>{var w,C;if(!G){if(p)return null===(C=p[P])||void 0===C?void 0:C.bind(p);throw new U(`"${m}" plugin is not implemented on ${I}`,T.Unimplemented)}{const A=null==G?void 0:G.methods.find(L=>P===L.name);if(A)return"promise"===A.rtype?L=>i.nativePromise(m,P.toString(),L):(L,S)=>i.nativeCallback(m,P.toString(),L,S);if(p)return null===(w=p[P])||void 0===w?void 0:w.bind(p)}})(L,p);if(S){const k=S(...C);return P=null==k?void 0:k.remove,k}throw new U(`"${m}.${p}()" is not implemented on ${I}`,T.Unimplemented)});return"addListener"===p&&(A.remove=(0,c.Z)(function*(){return P()})),A};return w.toString=()=>`${p.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:p,writable:!1,configurable:!1}),w},ee=Y("addListener"),te=Y("removeListener"),ge=(p,P)=>{const w=ee({eventName:p},P),C=function(){var L=(0,c.Z)(function*(){const S=yield w;te({eventName:p,callbackId:S},P)});return function(){return L.apply(this,arguments)}}(),A=new Promise(L=>w.then(()=>L({remove:C})));return A.remove=(0,c.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield C()}),A},q=new Proxy({},{get(p,P){switch(P){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return G?ge:ee;case"removeListener":return te;default:return Y(P)}}});return g[m]=q,Z.set(m,{name:m,proxy:q,platforms:new Set([...Object.keys(v),...G?[I]:[]])}),q});return i.convertFileSrc||(i.convertFileSrc=m=>m),i.getPlatform=D,i.handleError=m=>r.console.error(m),i.isNativePlatform=le,i.isPluginAvailable=ue,i.pluginMethodNoop=(m,v,x)=>Promise.reject(`${x} does not have an implementation of "${v}".`),i.registerPlugin=me,i.Exception=U,i.DEBUG=!!i.DEBUG,i.isLoggingEnabled=!!i.isLoggingEnabled,i.platform=i.getPlatform(),i.isNative=i.isNativePlatform(),i},l=(r=>r.Capacitor=n(r))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),h=l.registerPlugin;class N{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){var a=this;this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const o=this.windowListeners[e];o&&!o.registered&&this.addWindowListener(o);const d=function(){var g=(0,c.Z)(function*(){return a.removeListener(e,t)});return function(){return g.apply(this,arguments)}}(),i=Promise.resolve({remove:d});return Object.defineProperty(i,"remove",{value:(g=(0,c.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield d()}),function(){return g.apply(this,arguments)})}),i;var g}removeAllListeners(){var e=this;return(0,c.Z)(function*(){e.listeners={};for(const t in e.windowListeners)e.removeWindowListener(e.windowListeners[t]);e.windowListeners={}})()}notifyListeners(e,t){const a=this.listeners[e];a&&a.forEach(s=>s(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:a=>{this.notifyListeners(t,a)}}}unimplemented(e="not implemented"){return new l.Exception(e,T.Unimplemented)}unavailable(e="not available"){return new l.Exception(e,T.Unavailable)}removeListener(e,t){var a=this;return(0,c.Z)(function*(){const s=a.listeners[e];if(!s)return;const o=s.indexOf(t);a.listeners[e].splice(o,1),a.listeners[e].length||a.removeWindowListener(a.windowListeners[e])})()}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const M=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),J=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class re extends N{getCookies(){return(0,c.Z)(function*(){const e=document.cookie,t={};return e.split(";").forEach(a=>{if(a.length<=0)return;let[s,o]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=J(s).trim(),o=J(o).trim(),t[s]=o}),t})()}setCookie(e){return(0,c.Z)(function*(){try{const t=M(e.key),a=M(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,o=(e.path||"/").replace("path=",""),d=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${s}; path=${o}; ${d};`}catch(t){return Promise.reject(t)}})()}deleteCookie(e){return(0,c.Z)(function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}})()}clearCookies(){return(0,c.Z)(function*(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})()}clearAllCookies(){var e=this;return(0,c.Z)(function*(){try{yield e.clearCookies()}catch(t){return Promise.reject(t)}})()}}h("CapacitorCookies",{web:()=>new re});const ne=function(){var r=(0,c.Z)(function*(e){return new Promise((t,a)=>{const s=new FileReader;s.onload=()=>{const o=s.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},s.onerror=o=>a(o),s.readAsDataURL(e)})});return function(t){return r.apply(this,arguments)}}();class se extends N{request(e){return(0,c.Z)(function*(){const t=((r,e={})=>{const t=Object.assign({method:r.method||"GET",headers:r.headers},e),s=((r={})=>{const e=Object.keys(r);return Object.keys(r).map(s=>s.toLocaleLowerCase()).reduce((s,o,d)=>(s[o]=r[e[d]],s),{})})(r.headers)["content-type"]||"";if("string"==typeof r.data)t.body=r.data;else if(s.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[d,i]of Object.entries(r.data||{}))o.set(d,i);t.body=o.toString()}else if(s.includes("multipart/form-data")){const o=new FormData;if(r.data instanceof FormData)r.data.forEach((i,g)=>{o.append(g,i)});else for(const i of Object.keys(r.data))o.append(i,r.data[i]);t.body=o;const d=new Headers(t.headers);d.delete("content-type"),t.headers=d}else(s.includes("application/json")||"object"==typeof r.data)&&(t.body=JSON.stringify(r.data));return t})(e,e.webFetchExtra),a=((r,e=!0)=>r?Object.entries(r).reduce((a,s)=>{const[o,d]=s;let i,g;return Array.isArray(d)?(g="",d.forEach(f=>{i=e?encodeURIComponent(f):f,g+=`${o}=${i}&`}),g.slice(0,-1)):(i=e?encodeURIComponent(d):d,g=`${o}=${i}`),`${a}&${g}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),s=a?`${e.url}?${a}`:e.url,o=yield fetch(s,t),d=o.headers.get("content-type")||"";let g,f,{responseType:i="text"}=o.ok?e:{};switch(d.includes("application/json")&&(i="json"),i){case"arraybuffer":case"blob":f=yield o.blob(),g=yield ne(f);break;case"json":g=yield o.json();break;default:g=yield o.text()}const W={};return o.headers.forEach((D,V)=>{W[V]=D}),{data:g,headers:W,status:o.status,url:o.url}})()}get(e){var t=this;return(0,c.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"GET"}))})()}post(e){var t=this;return(0,c.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"POST"}))})()}put(e){var t=this;return(0,c.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"PUT"}))})()}patch(e){var t=this;return(0,c.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})()}delete(e){var t=this;return(0,c.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})()}}h("CapacitorHttp",{web:()=>new se})},4535:(B,y,b)=>{b.d(y,{N:()=>K});var c=b(5861),_=b(5619),R=b(9468),E=b(5320),H=b(9843),z=b(4017);let K=(()=>{var T;class U{constructor(n,u,l,h){this.sqlite=n,this.platform=u,this.alertController=l,this.router=h,this.tablaTipo="CREATE TABLE IF NOT EXISTS tipo (id_tipo INTEGER PRIMARY KEY AUTOINCREMENT, descripcion VARCHAR(20));",this.tablaRol="CREATE TABLE IF NOT EXISTS rol (id_rol INTEGER PRIMARY KEY AUTOINCREMENT, nombrerol VARCHAR(10));",this.tablaUsuarios="CREATE TABLE IF NOT EXISTS usuario (id INTEGER PRIMARY KEY AUTOINCREMENT, nombre VARCHAR(30) NOT NULL, apellido VARCHAR(30) NOT NULL, correo VARCHAR(30) NOT NULL, fechanacimiento DATE NOT NULL, rut VARCHAR(13) NOT NULL, celular INTEGER NOT NULL, contrasena VARCHAR(30) NOT NULL, id_rol INTEGER NOT NULL, FOREIGN KEY(id_rol) REFERENCES rol(id_rol));",this.tablaVehiculo="CREATE TABLE IF NOT EXISTS vehiculo (id_vehiculo INTEGER PRIMARY KEY AUTOINCREMENT, marca VARCHAR(30) NOT NULL, modelo VARCHAR(30) NOT NULL, anio INTEGER NOT NULL, patente VARCHAR(6) NOT NULL, asientos INTEGER NOT NULL, id_usuario INTEGER NOT NULL, id_tipo INTEGER NOT NULL, FOREIGN KEY(id_usuario) REFERENCES usuario(id), FOREIGN KEY(id_tipo) REFERENCES tipo(id_tipo));",this.tablaViajes="CREATE TABLE IF NOT EXISTS viaje (id_viaje INTEGER PRIMARY KEY AUTOINCREMENT, f_viaje DATE NOT NULL, hora_salida DATETIME NOT NULL, salida VARCHAR(30) NOT NULL, destino VARCHAR(30) NOT NULL, cant_asientos INTEGER NOT NULL, total INTEGER NOT NULL, valor_asiento INTEGER NOT NULL, estado BOOLEAN NOT NULL, id_vehiculo INTEGER NOT NULL, FOREIGN KEY(id_vehiculo) REFERENCES vehiculo(id_vehiculo));",this.tablaDetalle="CREATE TABLE IF NOT EXISTS detalle (id_detalle INTEGER PRIMARY KEY AUTOINCREMENT, id_usuario INTEGER NOT NULL, id_viaje INTEGER NOT NULL, FOREIGN KEY(id_usuario) REFERENCES usuario(id), FOREIGN KEY(id_viaje) REFERENCES viaje(id_viaje));",this.registroRol="INSERT INTO rol VALUES (1, 'Usuario'), (2, 'Conductor');",this.listaUsuario=new _.X([]),this.isDBReady=new _.X(!1),this.crearBD()}dbState(){return this.isDBReady.asObservable()}fetchUsuario(){return this.listaUsuario.asObservable()}buscarCorreo(n,u){return this.database.executeSql("SELECT id, id_rol FROM usuario WHERE correo = ? AND contrasena = ?",[n,u]).then(l=>l.rows.length>0?l.rows.item(0):null).catch(l=>(this.presentAlert("Error al buscar usuario:"+l),!1))}buscarDatosUsuario(n){return this.database.executeSql("SELECT * FROM usuario WHERE id = ?",[n]).then(u=>{let l=[];if(u.rows.length>0)for(var h=0;h<u.rows.length;h++)l.push({id:u.rows.item(h).id,nombre:u.rows.item(h).nombre,apellido:u.rows.item(h).apellido,correo:u.rows.item(h).correo,fechanacimiento:u.rows.item(h).fechanacimiento,rut:u.rows.item(h).rut,celular:u.rows.item(h).celular,contrasena:u.rows.item(h).contrasena});return l})}buscarUsuario(){return this.database.executeSql("SELECT * FROM usuario",[]).then(n=>{let u=[];if(n.rows.length>0)for(var l=0;l<n.rows.length;l++)u.push({id:n.rows.item(l).id,nombre:n.rows.item(l).nombre,apellido:n.rows.item(l).apellido,fechanacimiento:n.rows.item(l).fechanacimiento,correo:n.rows.item(l).correo,rut:n.rows.item(l).rut,celular:n.rows.item(l).celular,contrasena:n.rows.item(l).contrasena});this.listaUsuario.next(u)})}insertarUsuario(n,u,l,h,j,F,N,X){return this.database.executeSql("INSERT INTO usuario(nombre, apellido, correo, fechanacimiento, rut, celular, contrasena, id_rol) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[n,u,l,h,j,F,N,X]).then(M=>{M?this.buscarUsuario():this.presentAlert("Error al insertar usuario en la base de datos.")}).catch(M=>{console.error("Error al insertar el usuario.",M)})}actualizarPerfil(n,u,l,h,j,F){return this.database.executeSql("UPDATE usuario SET nombre = ?, apellido = ?, correo = ?, fechanacimiento = ?, rut = ?, celular = ? WHERE nombre = ?",[n,u,l,h,j,F]).then(N=>{N?this.buscarUsuario():this.presentAlert("Error al actualizar usuario.")}).catch(N=>{console.error("Error al actualizar usuario en base de datos:",N)})}crearBD(){this.platform.ready().then(()=>{this.sqlite.create({name:"bdviago.bd",location:"default"}).then(n=>{this.database=n,this.crearTablas()}).catch(n=>{this.presentAlert("Error en platform: "+n)})})}crearTablas(){var n=this;return(0,c.Z)(function*(){try{yield n.database.executeSql(n.tablaTipo,[]),yield n.database.executeSql(n.tablaRol,[]),yield n.database.executeSql(n.tablaUsuarios,[]),yield n.database.executeSql(n.tablaVehiculo,[]),yield n.database.executeSql(n.tablaViajes,[]),yield n.database.executeSql(n.tablaDetalle,[]),yield n.database.executeSql(n.registroRol,[]),n.isDBReady.next(!0)}catch(u){n.presentAlert("Error en Crear Tablas: "+u)}})()}presentAlert(n){var u=this;return(0,c.Z)(function*(){yield(yield u.alertController.create({header:"Error",message:n,buttons:["Aceptar"]})).present()})()}}return(T=U).\u0275fac=function(n){return new(n||T)(R.LFG(E.e),R.LFG(H.t4),R.LFG(H.Br),R.LFG(z.F0))},T.\u0275prov=R.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),U})()}}]);